<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instant Car Recovery Quote | REV Towing & Recovery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #111;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .container {
      max-width: 700px;
      width: 100%;
      background: #181818;
      border-radius: 14px;
      padding: 20px 20px 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      border: 1px solid #2a2a2a;
    }

    .logo-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 10px;
    }

    .logo-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .logo-title h1 {
      font-size: 22px;
      font-weight: 700;
      color: #ffffff;
    }

    .logo-title p {
      font-size: 13px;
      color: #c2c2c2;
    }

    .badge {
      background: #e63946;
      color: white;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-weight: 600;
      white-space: nowrap;
    }

    .section {
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid #2a2a2a;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #ffffff;
    }

    label {
      font-size: 13px;
      display: block;
      margin-bottom: 4px;
      color: #dddddd;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 9px 10px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #101010;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      border-color: #e63946;
    }

    .help-text {
      font-size: 11px;
      color: #a0a0a0;
      margin-top: 3px;
    }

    .radio-row {
      font-size: 13px;
      color: #dddddd;
      margin-bottom: 8px;
    }

    .radio-row span {
      display: inline-block;
      min-width: 150px;
    }

    .radio-row label {
      display: inline-block;
      margin-right: 14px;
      font-size: 13px;
    }

    .radio-row input {
      margin-right: 4px;
    }

    .button-main {
      width: 100%;
      padding: 11px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ff4b5c, #e63946);
      color: #ffffff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 14px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.1s;
      box-shadow: 0 6px 20px rgba(230,57,70,0.4);
    }

    .button-main:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(230,57,70,0.6);
    }

    .button-main:active {
      transform: translateY(0);
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      opacity: 0.9;
    }

    .small-btn {
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #222;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }

    .result-box {
      margin-top: 18px;
      padding: 14px 14px 16px;
      border-radius: 12px;
      background: #101010;
      border: 1px solid #333;
      display: none;
    }

    .result-main {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }

    .result-main span.label {
      font-size: 13px;
      color: #bbbbbb;
    }

    .result-main span.price {
      font-size: 22px;
      font-weight: 700;
      color: #ffffff;
    }

    .result-breakdown {
      font-size: 12px;
      color: #b5b5b5;
      margin-bottom: 6px;
    }

    .small-note {
      font-size: 11px;
      color: #888888;
      line-height: 1.4;
    }

    .cta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-secondary,
    .btn-whatsapp {
      flex: 1;
      min-width: 150px;
      text-align: center;
      text-decoration: none;
      font-size: 13px;
      padding: 9px 10px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border: 1px solid #333;
      cursor: pointer;
    }

    .btn-secondary {
      background: #222;
      color: #f5f5f5;
    }

    .btn-whatsapp {
      background: #25D366;
      color: #ffffff;
      border-color: #25D366;
    }

    .whats-bubble {
      font-size: 11px;
      color: #a5a5a5;
      margin-top: 4px;
    }

    @media (max-width: 480px) {
      .logo-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .result-main {
        flex-direction: column;
        align-items: flex-start;
      }
      .badge {
        align-self: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-row">
      <div class="logo-title">
        <h1>Instant Car Recovery Quote</h1>
        <p>REV Towing &amp; Recovery – East &amp; North London · 24/7 service</p>
      </div>
      <div class="badge">Live price estimate</div>
    </div>

    <!-- STEP 1 -->
    <div class="section">
      <div class="section-title">Step 1 · Vehicle details</div>

      <label for="regInput">Vehicle reg</label>
      <input id="regInput" type="text" placeholder="e.g. AB12CDE">
      <div class="help-text">
        This helps us match your quote with your call or WhatsApp message.
      </div>

      <label for="weightSelect" style="margin-top:10px;">Vehicle type</label>
      <select id="weightSelect" style="width:100%; padding:9px 10px; border-radius:8px; border:1px solid #333; background:#101010; color:#f5f5f5; font-size:14px;">
        <option value="1400">Small car (up to 1500 kg)</option>
        <option value="1700">Medium car (1501–1800 kg)</option>
        <option value="2000">4x4 or Van (over 1800 kg)</option>
      </select>
      <div class="help-text">
        If you’re not sure, just choose the closest option – we’ll confirm on the phone.
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="section">
      <div class="section-title">Step 2 · Journey distance</div>

      <label for="pickupPostcode">Pickup postcode</label>
      <input id="pickupPostcode" type="text" placeholder="e.g. IG11 0XX">

      <label for="dropoffPostcode" style="margin-top:8px;">Drop-off postcode</label>
      <input id="dropoffPostcode" type="text" placeholder="e.g. RM10 9XX">

      <button type="button" class="small-btn" onclick="getDistanceFromPostcodes()">
        Detect distance automatically
      </button>

      <div class="help-text" id="distanceInfo" style="margin-top:4px;">
        We use an approximate road distance between the two postcodes (for estimate only).
      </div>

      <label for="distanceMiles" style="margin-top:10px;">Distance (miles)</label>
      <input id="distanceMiles" type="number" min="1" step="0.1" placeholder="e.g. 15">
      <div class="help-text">
        You can adjust this if needed.
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="section">
      <div class="section-title">Step 3 · Vehicle condition</div>

      <div class="radio-row">
        <span>Rolls in neutral?</span>
        <label><input type="radio" name="rollsNeutral" id="rollsNeutralYes" checked> Yes</label>
        <label><input type="radio" name="rollsNeutral" id="rollsNeutralNo"> No</label>
      </div>

      <div class="radio-row">
        <span>Accident / heavy damage?</span>
        <label><input type="radio" name="accident" id="accidentNo" checked> No</label>
        <label><input type="radio" name="accident" id="accidentYes"> Yes</label>
      </div>

      <div class="radio-row">
        <span>Urgent / blocking the road?</span>
        <label><input type="radio" name="urgent" id="urgentNo" checked> No</label>
        <label><input type="radio" name="urgent" id="urgentYes"> Yes</label>
      </div>

      <div class="radio-row">
        <span>Motorway?</span>
        <label><input type="radio" name="motorway" id="motorwayNo" checked> No</label>
        <label><input type="radio" name="motorway" id="motorwayYes"> Yes</label>
      </div>
    </div>

    <!-- BUTTON -->
    <button class="button-main" onclick="onCalculateClick()">Calculate my quote</button>

    <!-- RESULT -->
    <div id="resultBox" class="result-box">
      <div class="result-main">
        <span class="label">Estimated price</span>
        <span class="price" id="quoteTotal">£0</span>
      </div>
      <div id="quoteBreakdown" class="result-breakdown"></div>
      <div class="small-note">
        This is an instant online estimate based on the details you entered.  
        The final price may vary slightly depending on the exact situation on scene
        (access, location, traffic, extra waiting time, etc.).
      </div>

      <div class="cta-row">
        <a id="callLink" class="btn-secondary" href="tel:07990090028">
          Call now · 079 900 900 28
        </a>
        <a id="whatsLink" class="btn-whatsapp" target="_blank" rel="noopener">
          WhatsApp us this quote
        </a>
      </div>
      <div class="whats-bubble">
        When you tap WhatsApp, your quote and vehicle details will be pre-filled in the message.
      </div>
    </div>
  </div>

  <script>
    // --- Helper: convert degrees to radians
    function toRad(deg) {
      return deg * Math.PI / 180;
    }

    // --- Helper: haversine distance in km between two lat/lon points
    function haversineKm(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    // --- Get distance from UK postcodes using postcodes.io (approximate)
    async function getDistanceFromPostcodes() {
      const pickup = document.getElementById('pickupPostcode').value.trim();
      const dropoff = document.getElementById('dropoffPostcode').value.trim();
      const distanceField = document.getElementById('distanceMiles');
      const infoDiv = document.getElementById('distanceInfo');

      if (!pickup || !dropoff) {
        alert('Please enter both pickup and drop-off postcodes.');
        return;
      }

      infoDiv.textContent = 'Calculating distance...';

      try {
        const pc1 = pickup.replace(/\s+/g, '');
        const pc2 = dropoff.replace(/\s+/g, '');

        const resp1 = await fetch('https://api.postcodes.io/postcodes/' + encodeURIComponent(pc1));
        const data1 = await resp1.json();
        if (data1.status !== 200 || !data1.result) throw new Error('Invalid pickup postcode');

        const resp2 = await fetch('https://api.postcodes.io/postcodes/' + encodeURIComponent(pc2));
        const data2 = await resp2.json();
        if (data2.status !== 200 || !data2.result) throw new Error('Invalid drop-off postcode');

        const lat1 = data1.result.latitude;
        const lon1 = data1.result.longitude;
        const lat2 = data2.result.latitude;
        const lon2 = data2.result.longitude;

        const km = haversineKm(lat1, lon1, lat2, lon2);

        // approximate road distance (factor ~1.3)
        const miles = km * 0.621371 * 1.3;

        if (!miles || miles <= 0) throw new Error('Bad distance');

        const rounded = Math.max(1, Math.round(miles * 10) / 10); // 1 decimal, min 1 mile
        distanceField.value = rounded.toFixed(1);
        infoDiv.textContent = `Estimated distance: ${rounded.toFixed(1)} miles (approximate road distance).`;

      } catch (err) {
        console.error(err);
        infoDiv.textContent =
          'Could not calculate distance automatically. Please check the postcodes or enter miles manually.';
      }
    }

    function getCategory(weightKg) {
      if (weightKg <= 1500) return 1;
      if (weightKg <= 1800) return 2;
      return 3;
    }

    function calculateQuote(weightKg, distanceMiles, options) {
      const category = getCategory(weightKg);

      let baseFee;
      const ratePerMile = 3.0;   // £3 per mile from the first mile

      if (category === 1) {
        baseFee = 70;
      } else if (category === 2) {
        baseFee = 90;
      } else {
        baseFee = 100;
      }

      const distancePrice = distanceMiles * ratePerMile;
      const extraMiles = distanceMiles;

      let surcharge = 0;
      if (!options.rollsInNeutral) surcharge += 60;
      if (options.isAccident)      surcharge += 70;
      if (options.isUrgent)        surcharge += 25;
      if (options.isMotorway)      surcharge += 80;

      const multiplier = 1; // no time/day multipliers

      let total = (baseFee + distancePrice + surcharge) * multiplier;
      total = Math.round(total);

      return {
        total,
        baseFee,
        distancePrice,
        surcharge,
        multiplier,
        extraMiles,
        ratePerMile
      };
    }

    function onCalculateClick() {
      const distanceInput = document.getElementById('distanceMiles').value;
      const distanceMiles = parseFloat(distanceInput);

      if (!distanceMiles || distanceMiles <= 0) {
        alert('Please enter or calculate the distance in miles.');
        return;
      }

      const weightSelect = document.getElementById('weightSelect');
      const weightKg = parseFloat(weightSelect.value);

      const options = {
        rollsInNeutral: document.getElementById('rollsNeutralYes').checked,
        isAccident:     document.getElementById('accidentYes').checked,
        isUrgent:       document.getElementById('urgentYes').checked,
        isMotorway:     document.getElementById('motorwayYes').checked
      };

      const result = calculateQuote(weightKg, distanceMiles, options);

      document.getElementById('quoteTotal').innerText = '£' + result.total;

      const breakdownText =
        `Base: £${result.baseFee} · Distance: £${result.distancePrice.toFixed(2)} ` +
        `(${result.extraMiles.toFixed(1)} miles @ £${result.ratePerMile.toFixed(2)}/mile) · ` +
        `Extras: £${result.surcharge}`;

      document.getElementById('quoteBreakdown').innerText = breakdownText;
      document.getElementById('resultBox').style.display = 'block';

      const reg = (document.getElementById('regInput').value || '').trim();
      const vehicleTypeText = weightSelect.options[weightSelect.selectedIndex].text;

      let conditions = [];
      conditions.push(options.rollsInNeutral ? 'Rolls in neutral: YES' : 'Rolls in neutral: NO');
      conditions.push(options.isAccident ? 'Accident / heavy damage: YES' : 'Accident / heavy damage: NO');
      conditions.push(options.isUrgent ? 'Urgent / blocking road: YES' : 'Urgent / blocking road: NO');
      conditions.push(options.isMotorway ? 'Motorway: YES' : 'Motorway: NO');

      const messageLines = [
        'Hi, I have an online quote from your website:',
        '',
        reg ? ('Vehicle reg: ' + reg) : 'Vehicle reg: (not entered)',
        'Vehicle type: ' + vehicleTypeText,
        'Distance: ' + distanceMiles.toFixed(1) + ' miles',
        '',
        'Conditions:',
        '- ' + conditions.join('\n- '),
        '',
        'Estimated price: £' + result.total,
        '',
        'Can you confirm availability and final price, please?'
      ];

      const message = messageLines.join('\n');
      const encoded = encodeURIComponent(message);
      const whatsappUrl = 'https://wa.me/447990090028?text=' + encoded;
      document.getElementById('whatsLink').href = whatsappUrl;
    }
  </script>
</body>
</html>
